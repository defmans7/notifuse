Broadcast:
  type: object
  properties:
    id:
      type: string
      description: Unique identifier for the broadcast
      example: broadcast_12345
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    name:
      type: string
      description: Name of the broadcast
      example: Spring Newsletter 2024
      maxLength: 255
    channel_type:
      type: string
      description: Communication channel type
      example: email
    status:
      type: string
      enum:
        - draft
        - scheduled
        - sending
        - paused
        - sent
        - cancelled
        - failed
        - testing
        - test_completed
        - winner_selected
      description: Current status of the broadcast
      example: draft
    audience:
      $ref: '#/AudienceSettings'
    schedule:
      $ref: '#/ScheduleSettings'
    test_settings:
      $ref: '#/BroadcastTestSettings'
    utm_parameters:
      $ref: '#/UTMParameters'
    metadata:
      type: object
      additionalProperties: true
      description: Custom metadata for the broadcast
    winning_template:
      type: string
      nullable: true
      description: ID of the winning template variation
      example: template_winner
    test_sent_at:
      type: string
      format: date-time
      nullable: true
      description: When the A/B test was sent
    winner_sent_at:
      type: string
      format: date-time
      nullable: true
      description: When the winning variation was sent
    test_phase_recipient_count:
      type: integer
      description: Number of recipients in test phase
    winner_phase_recipient_count:
      type: integer
      description: Number of recipients in winner phase
    created_at:
      type: string
      format: date-time
      description: When the broadcast was created
    updated_at:
      type: string
      format: date-time
      description: When the broadcast was last updated
    started_at:
      type: string
      format: date-time
      nullable: true
      description: When the broadcast started sending
    completed_at:
      type: string
      format: date-time
      nullable: true
      description: When the broadcast completed sending
    cancelled_at:
      type: string
      format: date-time
      nullable: true
      description: When the broadcast was cancelled
    paused_at:
      type: string
      format: date-time
      nullable: true
      description: When the broadcast was paused
    pause_reason:
      type: string
      nullable: true
      description: Reason for pausing the broadcast

BroadcastTestSettings:
  type: object
  properties:
    enabled:
      type: boolean
      description: Whether A/B testing is enabled
      example: true
    sample_percentage:
      type: integer
      minimum: 1
      maximum: 100
      description: Percentage of audience to use for testing
      example: 20
    auto_send_winner:
      type: boolean
      description: Automatically send winning variation to remaining audience
      example: true
    auto_send_winner_metric:
      type: string
      enum:
        - open_rate
        - click_rate
      description: Metric used to determine the winner
      example: open_rate
    test_duration_hours:
      type: integer
      minimum: 1
      maximum: 168
      description: Duration of the test in hours (max 7 days)
      example: 24
    variations:
      type: array
      description: Test variations (2-8 variations allowed)
      minItems: 2
      maxItems: 8
      items:
        $ref: '#/BroadcastVariation'

BroadcastVariation:
  type: object
  required:
    - template_id
  properties:
    variation_name:
      type: string
      description: Name of this variation
      example: Variation A
    template_id:
      type: string
      description: Template ID for this variation
      example: template_variant_a
    metrics:
      $ref: '#/VariationMetrics'
    template:
      type: object
      nullable: true
      description: Full template object (populated when with_templates=true)

VariationMetrics:
  type: object
  properties:
    recipients:
      type: integer
      description: Number of recipients
    delivered:
      type: integer
      description: Number of delivered messages
    opens:
      type: integer
      description: Number of opens
    clicks:
      type: integer
      description: Number of clicks
    bounced:
      type: integer
      description: Number of bounces
    complained:
      type: integer
      description: Number of complaints
    unsubscribed:
      type: integer
      description: Number of unsubscribes

AudienceSettings:
  type: object
  required:
    - list
  properties:
    list:
      type: string
      description: List ID to send to
      example: newsletter
    segments:
      type: array
      description: Optional segment IDs to filter recipients
      items:
        type: string
      example:
        - premium_users
    exclude_unsubscribed:
      type: boolean
      description: Whether to exclude unsubscribed contacts
      example: true

ScheduleSettings:
  type: object
  properties:
    is_scheduled:
      type: boolean
      description: Whether the broadcast is scheduled
      example: true
    scheduled_date:
      type: string
      pattern: '^\d{4}-\d{2}-\d{2}$'
      description: Scheduled date in YYYY-MM-DD format
      example: '2024-03-15'
    scheduled_time:
      type: string
      pattern: '^\d{2}:\d{2}$'
      description: Scheduled time in HH:MM format
      example: '10:30'
    timezone:
      type: string
      description: IANA timezone
      example: America/New_York
    use_recipient_timezone:
      type: boolean
      description: Send at scheduled time in each recipient's timezone
      example: false

UTMParameters:
  type: object
  properties:
    source:
      type: string
      description: UTM source parameter
      example: newsletter
    medium:
      type: string
      description: UTM medium parameter
      example: email
    campaign:
      type: string
      description: UTM campaign parameter
      example: spring_2024
    term:
      type: string
      description: UTM term parameter
    content:
      type: string
      description: UTM content parameter

CreateBroadcastRequest:
  type: object
  required:
    - workspace_id
    - name
    - audience
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    name:
      type: string
      description: Name of the broadcast
      example: Spring Newsletter 2024
      maxLength: 255
    audience:
      $ref: '#/AudienceSettings'
    test_settings:
      $ref: '#/BroadcastTestSettings'
    tracking_enabled:
      type: boolean
      description: Enable click and open tracking
      example: true
    utm_parameters:
      $ref: '#/UTMParameters'
    metadata:
      type: object
      additionalProperties: true
      description: Custom metadata for the broadcast

UpdateBroadcastRequest:
  type: object
  required:
    - workspace_id
    - id
    - name
    - audience
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the broadcast to update
      example: broadcast_12345
    name:
      type: string
      description: Name of the broadcast
      example: Spring Newsletter 2024
      maxLength: 255
    audience:
      $ref: '#/AudienceSettings'
    schedule:
      $ref: '#/ScheduleSettings'
    test_settings:
      $ref: '#/BroadcastTestSettings'
    tracking_enabled:
      type: boolean
      description: Enable click and open tracking
      example: true
    utm_parameters:
      $ref: '#/UTMParameters'
    metadata:
      type: object
      additionalProperties: true
      description: Custom metadata for the broadcast

ScheduleBroadcastRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the broadcast to schedule
      example: broadcast_12345
    send_now:
      type: boolean
      description: Send immediately instead of scheduling
      example: false
    scheduled_date:
      type: string
      pattern: '^\d{4}-\d{2}-\d{2}$'
      description: Scheduled date in YYYY-MM-DD format (required if send_now=false)
      example: '2024-03-15'
    scheduled_time:
      type: string
      pattern: '^\d{2}:\d{2}$'
      description: Scheduled time in HH:MM format (required if send_now=false)
      example: '10:30'
    timezone:
      type: string
      description: IANA timezone
      example: America/New_York
    use_recipient_timezone:
      type: boolean
      description: Send at scheduled time in each recipient's timezone
      example: false

PauseBroadcastRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the broadcast to pause
      example: broadcast_12345

ResumeBroadcastRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the broadcast to resume
      example: broadcast_12345

CancelBroadcastRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the broadcast to cancel
      example: broadcast_12345

DeleteBroadcastRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the broadcast to delete
      example: broadcast_12345

SendToIndividualRequest:
  type: object
  required:
    - workspace_id
    - broadcast_id
    - recipient_email
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    broadcast_id:
      type: string
      description: ID of the broadcast
      example: broadcast_12345
    recipient_email:
      type: string
      format: email
      description: Email address to send test to
      example: test@example.com
    template_id:
      type: string
      description: Optional specific template variation to send
      example: template_variant_a

SelectWinnerRequest:
  type: object
  required:
    - workspace_id
    - id
    - template_id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the broadcast
      example: broadcast_12345
    template_id:
      type: string
      description: Template ID of the winning variation
      example: template_variant_a

BroadcastListResponse:
  type: object
  properties:
    broadcasts:
      type: array
      description: List of broadcasts
      items:
        $ref: '#/Broadcast'
    total_count:
      type: integer
      description: Total number of broadcasts matching the query
      example: 45

VariationResult:
  type: object
  properties:
    template_id:
      type: string
      description: Template ID for this variation
      example: template_variant_a
    template_name:
      type: string
      description: Template name
      example: Variation A
    recipients:
      type: integer
      description: Total sent emails
      example: 1000
    delivered:
      type: integer
      description: Total delivered emails
      example: 980
    opens:
      type: integer
      description: Number of opens
      example: 450
    clicks:
      type: integer
      description: Number of clicks
      example: 120
    open_rate:
      type: number
      format: float
      description: Open rate (opens / recipients)
      example: 0.45
    click_rate:
      type: number
      format: float
      description: Click rate (clicks / recipients)
      example: 0.12

TestResultsResponse:
  type: object
  properties:
    broadcast_id:
      type: string
      description: ID of the broadcast
      example: broadcast_12345
    status:
      type: string
      description: Current broadcast status
      example: testing
    test_started_at:
      type: string
      format: date-time
      nullable: true
      description: When the test started
    test_completed_at:
      type: string
      format: date-time
      nullable: true
      description: When the test completed
    variation_results:
      type: object
      additionalProperties:
        $ref: '#/VariationResult'
      description: Results for each variation, keyed by template_id
    recommended_winner:
      type: string
      nullable: true
      description: Recommended winning template ID based on metrics
      example: template_variant_a
    winning_template:
      type: string
      nullable: true
      description: Selected winning template ID
      example: template_variant_a
    is_auto_send_winner:
      type: boolean
      description: Whether winner will be automatically sent
      example: true
