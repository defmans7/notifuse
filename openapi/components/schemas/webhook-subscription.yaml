WebhookSubscription:
  type: object
  description: A webhook subscription that receives HTTP callbacks when events occur
  properties:
    id:
      type: string
      description: Unique identifier for the subscription
      example: whsub_a1b2c3d4e5f6
    name:
      type: string
      description: Human-readable name for the subscription
      example: Production Webhook
    url:
      type: string
      format: uri
      description: The HTTPS URL to receive webhook events
      example: https://api.example.com/webhooks/notifuse
    secret:
      type: string
      description: Secret key for signing webhook payloads (Standard Webhooks spec)
      example: whsec_a1b2c3d4e5f6g7h8i9j0
    settings:
      $ref: '#/WebhookSubscriptionSettings'
    event_types:
      type: array
      description: List of event types this subscription is subscribed to (flattened from settings for convenience)
      items:
        type: string
      example:
        - contact.created
        - contact.updated
        - email.sent
    custom_event_filters:
      $ref: '#/CustomEventFilters'
      description: Optional filters for custom_event.* event types (flattened from settings for convenience)
    enabled:
      type: boolean
      description: Whether the subscription is currently active
      example: true
    last_delivery_at:
      type: string
      format: date-time
      nullable: true
      description: Timestamp of the last delivery attempt
      example: '2024-01-15T10:30:00Z'
    created_at:
      type: string
      format: date-time
      description: When the subscription was created
      example: '2024-01-01T00:00:00Z'
    updated_at:
      type: string
      format: date-time
      description: When the subscription was last updated
      example: '2024-01-15T10:30:00Z'

WebhookSubscriptionSettings:
  type: object
  description: Settings for webhook subscription
  properties:
    event_types:
      type: array
      description: List of event types this subscription is subscribed to
      items:
        type: string
      example:
        - contact.created
        - contact.updated
        - email.sent
    custom_event_filters:
      $ref: '#/CustomEventFilters'

CustomEventFilters:
  type: object
  nullable: true
  description: Optional filters for custom_event.* event types
  properties:
    goal_types:
      type: array
      nullable: true
      description: Filter by goal type (e.g., purchase, subscription, lead)
      items:
        type: string
      example:
        - purchase
        - subscription
    event_names:
      type: array
      nullable: true
      description: Filter by event name (e.g., orders/fulfilled, payment.succeeded)
      items:
        type: string
      example:
        - orders/fulfilled
        - payment.succeeded

WebhookDelivery:
  type: object
  description: A record of a webhook delivery attempt
  properties:
    id:
      type: string
      description: Unique identifier for the delivery
      example: whdel_x1y2z3
    subscription_id:
      type: string
      description: ID of the subscription this delivery belongs to
      example: whsub_a1b2c3d4e5f6
    event_type:
      type: string
      description: Type of event that triggered the delivery
      example: contact.created
    payload:
      type: object
      description: The JSON payload sent in the webhook
      additionalProperties: true
    status:
      type: string
      enum:
        - pending
        - delivering
        - delivered
        - failed
      description: Current status of the delivery
      example: delivered
    attempts:
      type: integer
      description: Number of delivery attempts made
      example: 1
    max_attempts:
      type: integer
      description: Maximum number of retry attempts
      example: 10
    next_attempt_at:
      type: string
      format: date-time
      nullable: true
      description: When the next retry will be attempted
      example: '2024-01-15T10:35:00Z'
    last_attempt_at:
      type: string
      format: date-time
      nullable: true
      description: When the last attempt was made
      example: '2024-01-15T10:30:00Z'
    delivered_at:
      type: string
      format: date-time
      nullable: true
      description: When the delivery was successfully completed
      example: '2024-01-15T10:30:00Z'
    last_response_status:
      type: integer
      nullable: true
      description: HTTP status code from the last attempt
      example: 200
    last_response_body:
      type: string
      nullable: true
      description: Response body from the last attempt (truncated)
      example: '{"received": true}'
    last_error:
      type: string
      nullable: true
      description: Error message from the last failed attempt
      example: null
    created_at:
      type: string
      format: date-time
      description: When the delivery was created
      example: '2024-01-15T10:30:00Z'

WebhookEventType:
  type: string
  description: Available webhook event types
  enum:
    # Contact events
    - contact.created
    - contact.updated
    - contact.deleted
    # List events
    - list.subscribed
    - list.unsubscribed
    - list.confirmed
    - list.resubscribed
    - list.bounced
    - list.complained
    - list.pending
    - list.removed
    # Segment events
    - segment.joined
    - segment.left
    # Email events
    - email.sent
    - email.delivered
    - email.opened
    - email.clicked
    - email.bounced
    - email.complained
    - email.unsubscribed
    # Custom events
    - custom_event.created
    - custom_event.updated
    - custom_event.deleted

# Request/Response schemas

CreateWebhookSubscriptionRequest:
  type: object
  required:
    - workspace_id
    - name
    - url
    - event_types
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    name:
      type: string
      description: Human-readable name for the subscription
      example: Production Webhook
      minLength: 1
      maxLength: 255
    url:
      type: string
      format: uri
      description: The HTTPS URL to receive webhook events
      example: https://api.example.com/webhooks/notifuse
    event_types:
      type: array
      description: List of event types to subscribe to
      items:
        type: string
      minItems: 1
      example:
        - contact.created
        - contact.updated
    custom_event_filters:
      $ref: '#/CustomEventFilters'

CreateWebhookSubscriptionResponse:
  type: object
  properties:
    subscription:
      $ref: '#/WebhookSubscription'

UpdateWebhookSubscriptionRequest:
  type: object
  required:
    - workspace_id
    - id
    - name
    - url
    - event_types
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: The ID of the subscription to update
      example: whsub_a1b2c3d4e5f6
    name:
      type: string
      description: Updated name
      example: Production Webhook Updated
    url:
      type: string
      format: uri
      description: Updated URL
      example: https://api.example.com/webhooks/notifuse/v2
    event_types:
      type: array
      description: Updated list of event types
      items:
        type: string
      example:
        - contact.created
        - contact.updated
        - contact.deleted
    custom_event_filters:
      $ref: '#/CustomEventFilters'
    enabled:
      type: boolean
      description: Whether the subscription is enabled
      example: true

UpdateWebhookSubscriptionResponse:
  type: object
  properties:
    subscription:
      $ref: '#/WebhookSubscription'

DeleteWebhookSubscriptionRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: The ID of the subscription to delete
      example: whsub_a1b2c3d4e5f6

ToggleWebhookSubscriptionRequest:
  type: object
  required:
    - workspace_id
    - id
    - enabled
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: The ID of the subscription
      example: whsub_a1b2c3d4e5f6
    enabled:
      type: boolean
      description: Whether to enable or disable the subscription
      example: true

ToggleWebhookSubscriptionResponse:
  type: object
  properties:
    subscription:
      $ref: '#/WebhookSubscription'

RegenerateWebhookSecretRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: The ID of the subscription
      example: whsub_a1b2c3d4e5f6

RegenerateWebhookSecretResponse:
  type: object
  properties:
    subscription:
      $ref: '#/WebhookSubscription'

ListWebhookSubscriptionsResponse:
  type: object
  properties:
    subscriptions:
      type: array
      items:
        $ref: '#/WebhookSubscription'

GetWebhookSubscriptionResponse:
  type: object
  properties:
    subscription:
      $ref: '#/WebhookSubscription'

ListWebhookDeliveriesResponse:
  type: object
  properties:
    deliveries:
      type: array
      items:
        $ref: '#/WebhookDelivery'
    total:
      type: integer
      description: Total number of deliveries
      example: 150
    limit:
      type: integer
      description: Number of deliveries per page
      example: 20
    offset:
      type: integer
      description: Offset for pagination
      example: 0

TestWebhookRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: The ID of the subscription to test
      example: whsub_a1b2c3d4e5f6

TestWebhookResponse:
  type: object
  properties:
    success:
      type: boolean
      description: Whether the test webhook was delivered successfully
      example: true
    status_code:
      type: integer
      description: HTTP status code returned by the webhook endpoint
      example: 200
    response_body:
      type: string
      description: Response body from the webhook endpoint
      example: '{"received": true}'
    error:
      type: string
      nullable: true
      description: Error message if the test failed
      example: null

ListWebhookEventTypesResponse:
  type: object
  properties:
    event_types:
      type: array
      items:
        type: string
      example:
        - contact.created
        - contact.updated
        - contact.deleted
        - list.subscribed
        - list.unsubscribed
        - email.sent
        - email.delivered
