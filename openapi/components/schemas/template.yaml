Template:
  type: object
  properties:
    id:
      type: string
      description: Unique identifier for the template (alphanumeric, underscores, and hyphens only)
      example: welcome_email
      maxLength: 32
      pattern: ^[a-zA-Z0-9_-]+$
    name:
      type: string
      description: Name of the template
      example: Welcome Email
      maxLength: 32
    version:
      type: integer
      format: int64
      description: Version number of the template
      example: 1
    channel:
      type: string
      enum:
        - email
        - web
      description: Communication channel
      example: email
    email:
      $ref: '#/EmailTemplate'
    web:
      $ref: '#/WebTemplate'
    category:
      type: string
      enum:
        - marketing
        - transactional
        - welcome
        - opt_in
        - unsubscribe
        - bounce
        - blocklist
        - blog
        - other
      description: Template category
      example: transactional
      maxLength: 20
    template_macro_id:
      type: string
      nullable: true
      description: ID of the template macro (layout) to use
    integration_id:
      type: string
      nullable: true
      description: ID of the integration managing this template (e.g., Supabase)
    test_data:
      type: object
      additionalProperties: true
      description: Test data for template preview
      example:
        user_name: John Doe
        action_url: https://example.com/action
    settings:
      type: object
      additionalProperties: true
      description: Channel-specific third-party settings
    created_at:
      type: string
      format: date-time
      description: When the template was created
    updated_at:
      type: string
      format: date-time
      description: When the template was last updated
    deleted_at:
      type: string
      format: date-time
      nullable: true
      description: When the template was deleted (null if active)
  required:
    - id
    - name
    - channel
    - category

EmailTemplate:
  type: object
  properties:
    sender_id:
      type: string
      description: ID of the sender configuration to use
      example: sender_123
    reply_to:
      type: string
      format: email
      description: Reply-To email address
      example: support@example.com
    subject:
      type: string
      description: Email subject line (supports Liquid templating)
      example: Welcome, {{user_name}}!
    subject_preview:
      type: string
      nullable: true
      description: Preview text shown in email clients
      example: Get started with your account
    compiled_preview:
      type: string
      description: Compiled HTML preview of the email
    visual_editor_tree:
      type: object
      description: MJML visual editor tree structure
      example:
        type: mjml
        children: []
    text:
      type: string
      nullable: true
      description: Plain text version of the email
  required:
    - subject
    - compiled_preview
    - visual_editor_tree

WebTemplate:
  type: object
  properties:
    content:
      type: object
      additionalProperties: true
      description: Tiptap JSON content (source of truth for web templates)
    html:
      type: string
      description: Pre-rendered HTML for display
    plain_text:
      type: string
      description: Extracted text for search indexing
  required:
    - content

CreateTemplateRequest:
  type: object
  required:
    - workspace_id
    - id
    - name
    - channel
    - category
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: Unique identifier for the template (alphanumeric, underscores, and hyphens only)
      example: welcome_email
      maxLength: 32
      pattern: ^[a-zA-Z0-9_-]+$
    name:
      type: string
      description: Name of the template
      example: Welcome Email
      maxLength: 32
    channel:
      type: string
      enum:
        - email
        - web
      description: Communication channel
      example: email
    email:
      $ref: '#/EmailTemplate'
    web:
      $ref: '#/WebTemplate'
    category:
      type: string
      enum:
        - marketing
        - transactional
        - welcome
        - opt_in
        - unsubscribe
        - bounce
        - blocklist
        - blog
        - other
      description: Template category
      example: transactional
    template_macro_id:
      type: string
      nullable: true
      description: ID of the template macro (layout) to use
    test_data:
      type: object
      additionalProperties: true
      description: Test data for template preview
    settings:
      type: object
      additionalProperties: true
      description: Channel-specific settings

UpdateTemplateRequest:
  type: object
  required:
    - workspace_id
    - id
    - name
    - channel
    - category
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the template to update
      example: welcome_email
      maxLength: 32
    name:
      type: string
      description: Name of the template
      example: Welcome Email
      maxLength: 32
    channel:
      type: string
      enum:
        - email
        - web
      description: Communication channel
      example: email
    email:
      $ref: '#/EmailTemplate'
    web:
      $ref: '#/WebTemplate'
    category:
      type: string
      enum:
        - marketing
        - transactional
        - welcome
        - opt_in
        - unsubscribe
        - bounce
        - blocklist
        - blog
        - other
      description: Template category
      example: transactional
    template_macro_id:
      type: string
      nullable: true
      description: ID of the template macro (layout) to use
    test_data:
      type: object
      additionalProperties: true
      description: Test data for template preview
    settings:
      type: object
      additionalProperties: true
      description: Channel-specific settings

DeleteTemplateRequest:
  type: object
  required:
    - workspace_id
    - id
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    id:
      type: string
      description: ID of the template to delete
      example: welcome_email

CompileTemplateRequest:
  type: object
  required:
    - workspace_id
    - message_id
    - visual_editor_tree
  properties:
    workspace_id:
      type: string
      description: The ID of the workspace
      example: ws_1234567890
    message_id:
      type: string
      description: Unique message ID for tracking
      example: msg_abc123
    visual_editor_tree:
      type: object
      description: MJML visual editor tree structure (must have type 'mjml')
      additionalProperties: true
    test_data:
      type: object
      description: Data to use for Liquid templating
      additionalProperties: true
      example:
        user_name: John Doe
        action_url: https://example.com/action
    tracking_settings:
      $ref: '#/TrackingSettings'
    channel:
      type: string
      enum:
        - email
        - web
      description: Channel filter for block visibility

CompileTemplateResponse:
  type: object
  properties:
    success:
      type: boolean
      description: Whether compilation was successful
    mjml:
      type: string
      description: Generated MJML markup
    html:
      type: string
      description: Compiled HTML output
    error:
      type: object
      description: MJML compilation error details, if any
      properties:
        message:
          type: string

TrackingSettings:
  type: object
  properties:
    enable_tracking:
      type: boolean
      description: Whether to enable click/open tracking
    endpoint:
      type: string
      description: API endpoint for tracking redirects
    utm_source:
      type: string
      description: UTM source parameter
    utm_medium:
      type: string
      description: UTM medium parameter
    utm_campaign:
      type: string
      description: UTM campaign parameter
    utm_content:
      type: string
      description: UTM content parameter
    utm_term:
      type: string
      description: UTM term parameter
    workspace_id:
      type: string
      description: Workspace ID for tracking
    message_id:
      type: string
      description: Message ID for tracking
